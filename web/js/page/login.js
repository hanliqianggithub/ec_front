$(function(){$("#login-btn").click(function(){var o="http://47.92.107.76/exper/server",e=$("#username"),t=$("#password"),n="";if(""==$.trim(e.val())?(n="用户名不能为空",e.focus()):""==$.trim(t.val())&&(n="密码不能为空",t.focus()),""!=n)$(".box .msg").html(n);else{var a=$.trim(e.val()),s=$.trim(t.val());$.ajax({type:"POST",url:o+"/login",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{account:a,password:s},dataType:"json",success:function(e){if("200"!=e.code)return $(".box .msg").html("用户名或密码不正确，请重新输入"),!1;$.ajax({type:"GET",url:o+"/user/info",headers:{token:e.data.token},dataType:"json",success:function(t){"200"==t.code?""!=t.data.name&&t.data.roles.length>0?$.ajax({type:"GET",url:o+"/refreshToken",headers:{token:e.data.token},dataType:"json",success:function(o){"200"==o.code&&((new Cookies).set("md_user","username="+t.data.name+"&userid="+t.data.id+"&token="+o.data.token+"&role="+t.data.roles[0].name,"s3500"),"manager"==t.data.roles[0].name?window.location.href="statistics.html":7==t.data.id||"7"==t.data.id?window.location.href="dataview.html":window.location.href="datalist.html")},error:function(o){console.log(o),$(".box .msg").html("请求失败，请联系管理员")}}):(console.log("name or role is null"),$(".box .msg").html("个人信息不完善，请联系管理员")):(console.log(xhr),$(".box .msg").html("请求失败，请联系管理员"))},error:function(o){console.log(o),$(".box .msg").html("请求失败，请联系管理员")}})},error:function(o){console.log(o),$(".box .msg").html("请求失败，请联系管理员")}})}}),$(document).keydown(function(o){13===o.keyCode&&$("#login-btn").trigger("click")}),$("#username").focus(function(){$(this).parents(".input").addClass("input-focus")}),$("#username").blur(function(){$(this).parents(".input").removeClass("input-focus")}),$("#password").focus(function(){$(this).parents(".input").addClass("input-focus")}),$("#password").blur(function(){$(this).parents(".input").removeClass("input-focus")})});