$(function(){$("#login-btn").click(function(){var o="http://47.92.107.76/server",t=$("#username"),e=$("#password"),n="";if(""==$.trim(t.val())?(n="用户名不能为空",t.focus()):""==$.trim(e.val())&&(n="密码不能为空",e.focus()),""!=n)$(".box .msg").html(n);else{var a=$.trim(t.val()),s=$.trim(e.val());$.ajax({type:"POST",url:o+"/login",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{account:a,password:s},dataType:"json",success:function(t){if("200"!=t.code)return $(".box .msg").html("用户名或密码不正确，请重新输入"),!1;$.ajax({type:"GET",url:o+"/user/info",headers:{token:t.data.token},dataType:"json",success:function(e){"200"==e.code?""!=e.data.name&&e.data.roles.length>0?$.ajax({type:"GET",url:o+"/refreshToken",headers:{token:t.data.token},dataType:"json",success:function(o){"200"==o.code&&((new Cookies).set("md_user","username="+e.data.name+"&userid="+e.data.id+"&token="+o.data.token+"&role="+e.data.roles[0].name,"s3500"),"manager"==e.data.roles[0].name?window.location.href="statistics.html":4==e.data.id||"4"==e.data.id?window.location.href="dataview.html":window.location.href="datalist.html")},error:function(o){console.log(o),$(".box .msg").html("请求失败，请联系管理员")}}):(console.log("name or role is null"),$(".box .msg").html("个人信息不完善，请联系管理员")):(console.log(xhr),$(".box .msg").html("请求失败，请联系管理员"))},error:function(o){console.log(o),$(".box .msg").html("请求失败，请联系管理员")}})},error:function(o){console.log(o),$(".box .msg").html("请求失败，请联系管理员")}})}}),$(document).keydown(function(o){13===o.keyCode&&$("#login-btn").trigger("click")}),$("#username").focus(function(){$(this).parents(".input").addClass("input-focus")}),$("#username").blur(function(){$(this).parents(".input").removeClass("input-focus")}),$("#password").focus(function(){$(this).parents(".input").addClass("input-focus")}),$("#password").blur(function(){$(this).parents(".input").removeClass("input-focus")})});