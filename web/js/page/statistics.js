function getDepartmentList(t,e){var a=[];return $.ajax({type:"GET",async:!1,url:t+"/department",headers:{token:e},dataType:"json",success:function(t){"200"==t.code?a=t.data.list:console.log(t.code)},error:function(t){console.log(t)}}),a}function getUserList(t,e){var a=[];return $.ajax({type:"GET",async:!1,url:t+"/user",headers:{token:e},dataType:"json",success:function(t){"200"==t.code?a=t.data:console.log(t.code)},error:function(t){console.log(t)}}),a}$(function(){$(".sorts").hide();var t="http://47.92.107.76/server";new Vue({el:"#statistics",data:{username:"",token:"",isHiddenDataMenu:!1,isHiddenStatisticsMenu:!0,startDate:"",endDate:"",departmentList:[],userList:[],sTotalList:null,sDepartmentList:null,sUserList:null,sortparam:"",sorttype:1},methods:{Search:function(){console.log(1);var e=this,a=""==$("#start-date").val()?e.startDate:$("#start-date").val(),o=""==$("#end-date").val()?e.endDate:$("#end-date").val(),s=$("#department-list").val(),n=$("#user-list").val();e.startDate=a,e.endDate=o,$(".main-msg div .front-blue:first-child").html(a),$(".main-msg div .front-blue:last-child").html(o),""!=a&&""!=o&&"0"!=n?(e.sDepartmentList=null,e.sUserList=null,$.ajax({type:"GET",url:t+"/historyStatis/user/"+n,headers:{token:e.token},data:{begin:a,end:o},dataType:"json",success:function(t){if("200"==t.code){e.sTotalList=t.data,e.sTotalList.OtherChannels=t.data.totalCustomer-t.data.pushCount;var a=Number(t.data.totalCallTime/t.data.totalCallCount).toFixed(2);e.sTotalList.MeantimeLength=NaN==a?0:a;var o=Number(t.data.validCount/t.data.totalCallCount*100).toFixed(2);e.sTotalList.ConnectionRate=NaN==o?0:o}else console.log(t.code)},error:function(t){console.log(t)}})):""!=a&&""!=o&&"0"!=s?(e.sDepartmentList=null,$.ajax({type:"GET",url:t+"/historyStatis/dept/"+s,headers:{token:e.token},data:{begin:a,end:o},dataType:"json",success:function(t){if("200"==t.code){e.sTotalList=t.data,e.sTotalList.OtherChannels=t.data.totalCustomer-t.data.pushCount;var a=Number(t.data.totalCallTime/t.data.totalCallCount).toFixed(2);e.sTotalList.MeantimeLength=NaN==a?0:a;var o=Number(t.data.validCount/t.data.totalCallCount*100).toFixed(2);e.sTotalList.ConnectionRate=NaN==o?0:o}else console.log(t.code)},error:function(t){console.log(t)}}),$.ajax({type:"GET",url:t+"/historyStatis/user",headers:{token:e.token},data:{begin:a,end:o,deptId:s},dataType:"json",success:function(t){if(t.code="200"){e.sUserList=t.data;for(var a=0;a<e.sUserList.length;a++){e.sUserList[a].OtherChannels=t.data[a].totalCustomer-t.data[a].pushCount;var o=Number(t.data[a].totalCallTime/t.data[a].totalCallCount).toFixed(2);e.sUserList[a].MeantimeLength=NaN==o?0:o;var s=Number(t.data[a].validCount/t.data[a].totalCallCount*100).toFixed(2);e.sUserList[a].ConnectionRate=NaN==s?0:s}}else console.log(t.code)},error:function(t){console.log(t)}})):""!=a&&""!=o&&($.ajax({type:"GET",url:t+"/historyStatis/company",headers:{token:e.token},data:{begin:a,end:o},dataType:"json",success:function(t){if("200"==t.code){e.sTotalList=t.data,e.sTotalList.OtherChannels=t.data.totalCustomer-t.data.pushCount;var a=Number(t.data.totalCallTime/t.data.totalCallCount).toFixed(2);e.sTotalList.MeantimeLength=NaN==a?0:a;var o=Number(t.data.validCount/t.data.totalCallCount*100).toFixed(2);e.sTotalList.ConnectionRate=NaN==o?0:o}else console.log(t.code)},error:function(t){console.log(t)}}),$.ajax({type:"GET",url:t+"/historyStatis/dept",headers:{token:e.token},data:{begin:a,end:o},dataType:"json",success:function(t){if("200"==t.code){e.sDepartmentList=t.data;for(var a=0;a<e.sDepartmentList.length;a++){e.sDepartmentList[a].OtherChannels=t.data[a].totalCustomer-t.data[a].pushCount;var o=Number(t.data[a].totalCallTime/t.data[a].totalCallCount).toFixed(2);e.sDepartmentList[a].MeantimeLength=NaN==o?0:o;var s=Number(t.data[a].validCount/t.data[a].totalCallCount*100).toFixed(2);e.sDepartmentList[a].ConnectionRate=NaN==s?0:s}}else console.log(t.code)},error:function(t){console.log(t)}}),$.ajax({type:"GET",url:t+"/historyStatis/user",headers:{token:e.token},data:{begin:a,end:o},dataType:"json",success:function(t){if("200"==t.code){e.sUserList=t.data;for(var a=0;a<e.sUserList.length;a++){e.sUserList[a].OtherChannels=t.data[a].totalCustomer-t.data[a].pushCount;var o=Number(t.data[a].totalCallTime/t.data[a].totalCallCount).toFixed(2);e.sUserList[a].MeantimeLength=NaN==o?0:o;var s=Number(t.data[a].validCount/t.data[a].totalCallCount*100).toFixed(2);e.sUserList[a].ConnectionRate=NaN==s?0:s}}else console.log(t.code)},error:function(t){console.log(t)}}))}},created:function(){var e=this,a=new Cookies,o=a.getChild("md_user","username");if(null!=o&&""!=o){this.username=o,this.token=a.getChild("md_user","token");var s=a.getChild("md_user","role");"manager"!=s&&"leader"!=s||(this.isHiddenStatisticsMenu=!1),"manager"==s&&(this.isHiddenDataMenu=!0)}else window.location.href="login.html";var n=new Date;e.startDate=n.getFullYear()+"-"+(n.getMonth()+1)+"-1",e.endDate=n.getFullYear()+"-"+(n.getMonth()+1)+"-"+n.getDate(),e.departmentList=getDepartmentList(t,e.token),e.userList=getUserList(t,e.token),e.Search()}})});