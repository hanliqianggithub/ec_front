function getDepartmentList(t,e){var a=[];return $.ajax({type:"GET",async:!1,url:t+"/department",headers:{token:e},dataType:"json",success:function(t){"200"==t.code?a=t.data.list:console.log(t.code)},error:function(t){console.log(t)}}),a}function getUserList(t,e){var a=[];return $.ajax({type:"GET",async:!1,url:t+"/user",headers:{token:e},dataType:"json",success:function(t){"200"==t.code?a=t.data:console.log(t.code)},error:function(t){console.log(t)}}),a}function getToken(){var t=(new Cookies).getChild("md_user","token");if(null!=t&&""!=t)return t;window.location.href="login.html"}$(function(){$(".sorts").hide();var t="http://47.92.107.76/server";new Vue({el:"#statistics",data:{username:"",token:"",isHiddenDataMenu:!1,isHiddenStatisticsMenu:!0,startDate:"",endDate:"",departmentList:[],userList:[],sTotalList:null,sDepartmentList:null,sUserList:null,sortparam:"",sorttype:1},methods:{Search:function(){var e=this;e.token=getToken();var a=""==$("#start-date").val()?e.startDate:$("#start-date").val(),o=""==$("#end-date").val()?e.endDate:$("#end-date").val(),n=$("#department-list").val(),s=$("#user-list").val();e.startDate=a,e.endDate=o,$(".main-msg div .front-blue:first-child").html(a),$(".main-msg div .front-blue:last-child").html(o),""!=a&&""!=o&&"0"!=s?(e.sDepartmentList=null,e.sUserList=null,$.ajax({type:"GET",url:t+"/historyStatis/user/"+s,headers:{token:e.token},data:{begin:a,end:o},dataType:"json",success:function(t){if("200"==t.code){e.sTotalList=t.data;var a=Number(t.data.totalCallTime/t.data.totalCallCount).toFixed(2);e.sTotalList.MeantimeLength="NaN"==a?0:a;var o=Number(t.data.validCount/t.data.totalCallCount*100).toFixed(2);e.sTotalList.ConnectionRate="NaN"==o?0:o}else console.log(t.code)},error:function(t){console.log(t)}})):""!=a&&""!=o&&"0"!=n?(e.sDepartmentList=null,$.ajax({type:"GET",url:t+"/historyStatis/dept/"+n,headers:{token:e.token},data:{begin:a,end:o},dataType:"json",success:function(t){if("200"==t.code){e.sTotalList=t.data;var a=Number(t.data.totalCallTime/t.data.totalCallCount).toFixed(2);e.sTotalList.MeantimeLength="NaN"==a?0:a;var o=Number(t.data.validCount/t.data.totalCallCount*100).toFixed(2);e.sTotalList.ConnectionRate="NaN"==o?0:o}else console.log(t.code)},error:function(t){console.log(t)}}),$.ajax({type:"GET",url:t+"/historyStatis/user",headers:{token:e.token},data:{begin:a,end:o,deptId:n},dataType:"json",success:function(t){if(t.code="200"){e.sUserList=t.data;for(var a=0;a<e.sUserList.length;a++){var o=Number(t.data[a].totalCallTime/t.data[a].totalCallCount).toFixed(2);e.sUserList[a].MeantimeLength="NaN"==o?0:o;var n=Number(t.data[a].validCount/t.data[a].totalCallCount*100).toFixed(2);e.sUserList[a].ConnectionRate="NaN"==n?0:n}}else console.log(t.code)},error:function(t){console.log(t)}})):""!=a&&""!=o&&($.ajax({type:"GET",url:t+"/historyStatis/company",headers:{token:e.token},data:{begin:a,end:o},dataType:"json",success:function(t){if("200"==t.code){e.sTotalList=t.data;var a=Number(t.data.totalCallTime/t.data.totalCallCount).toFixed(2);e.sTotalList.MeantimeLength="NaN"==a?0:a;var o=Number(t.data.validCount/t.data.totalCallCount*100).toFixed(2);e.sTotalList.ConnectionRate="NaN"==o?0:o}else console.log(t.code)},error:function(t){console.log(t)}}),$.ajax({type:"GET",url:t+"/historyStatis/dept",headers:{token:e.token},data:{begin:a,end:o},dataType:"json",success:function(t){if("200"==t.code){e.sDepartmentList=t.data;for(var a=0;a<e.sDepartmentList.length;a++){var o=Number(t.data[a].totalCallTime/t.data[a].totalCallCount).toFixed(2);e.sDepartmentList[a].MeantimeLength="NaN"==o?0:o;var n=Number(t.data[a].validCount/t.data[a].totalCallCount*100).toFixed(2);e.sDepartmentList[a].ConnectionRate="NaN"==n?0:n}}else console.log(t.code)},error:function(t){console.log(t)}}),$.ajax({type:"GET",url:t+"/historyStatis/user",headers:{token:e.token},data:{begin:a,end:o},dataType:"json",success:function(t){if("200"==t.code){e.sUserList=t.data;for(var a=0;a<e.sUserList.length;a++){var o=Number(t.data[a].totalCallTime/t.data[a].totalCallCount).toFixed(2);e.sUserList[a].MeantimeLength="NaN"==o?0:o;var n=Number(t.data[a].validCount/t.data[a].totalCallCount*100).toFixed(2);e.sUserList[a].ConnectionRate="NaN"==n?0:n}}else console.log(t.code)},error:function(t){console.log(t)}}))}},created:function(){var e=this,a=new Cookies,o=a.getChild("md_user","username");if(null!=o&&""!=o){this.username=o,this.token=a.getChild("md_user","token");var n=a.getChild("md_user","role");"manager"!=n&&"leader"!=n||(this.isHiddenStatisticsMenu=!1),"manager"==n&&(this.isHiddenDataMenu=!0)}else window.location.href="login.html";var s=new Date;e.startDate=s.getFullYear()+"-"+(s.getMonth()+1)+"-1",e.endDate=s.getFullYear()+"-"+(s.getMonth()+1)+"-"+s.getDate(),e.departmentList=getDepartmentList(t,e.token),e.userList=getUserList(t,e.token),e.Search()}})});