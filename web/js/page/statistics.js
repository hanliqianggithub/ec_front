function getDepartmentList(t,e){var a=[];return $.ajax({type:"GET",async:!1,url:t+"/department",headers:{token:e},dataType:"json",success:function(t){"200"==t.code?a=t.data.list:console.log(t.code)},error:function(t){console.log(t)}}),a}function getUserList(t,e){var a=[];return $.ajax({type:"GET",async:!1,url:t+"/user",headers:{token:e},dataType:"json",success:function(t){"200"==t.code?a=t.data:console.log(t.code)},error:function(t){console.log(t)}}),a}$(function(){$(".sorts").hide();var t="http://47.92.107.76/server";new Vue({el:"#statistics",data:{username:"",token:"",isHiddenDataMenu:!1,isHiddenStatisticsMenu:!0,startDate:"",endDate:"",departmentList:[],userList:[],sTotalList:null,sDepartmentList:null,sUserList:null},methods:{Search:function(){var e=this,a=""==$("#start-date").val()?e.startDate:$("#start-date").val(),o=""==$("#end-date").val()?e.endDate:$("#end-date").val(),s=$("#department-list").val(),n=$("#user-list").val();$(".main-msg div .front-blue:first-child").html(a),$(".main-msg div .front-blue:last-child").html(o),""!=a&&""!=o&&"0"!=n?(e.sDepartmentList=null,e.sUserList=null,$.ajax({type:"GET",url:t+"/historyStatis/user/"+n,headers:{token:e.token},data:{begin:a,end:o},dataType:"json",success:function(t){"200"==t.code?(e.sTotalList=t.data,e.sTotalList.OtherChannels=t.data.totalCustomer-t.data.pushCount,e.sTotalList.MeantimeLength=Number(t.data.totalCallTime/t.data.totalCallCount).toFixed(2),e.sTotalList.ConnectionRate=Number(t.data.validCount/t.data.totalCallCount*100).toFixed(2)):console.log(t.code)},error:function(t){console.log(t)}})):""!=a&&""!=o&&"0"!=s?(e.sDepartmentList=null,$.ajax({type:"GET",url:t+"/historyStatis/dept/"+s,headers:{token:e.token},data:{begin:a,end:o},dataType:"json",success:function(t){"200"==t.code?(e.sTotalList=t.data,e.sTotalList.OtherChannels=t.data.totalCustomer-t.data.pushCount,e.sTotalList.MeantimeLength=Number(t.data.totalCallTime/t.data.totalCallCount).toFixed(2),e.sTotalList.ConnectionRate=Number(t.data.validCount/t.data.totalCallCount*100).toFixed(2)):console.log(t.code)},error:function(t){console.log(t)}}),$.ajax({type:"GET",url:t+"/historyStatis/user",headers:{token:e.token},data:{begin:a,end:o,deptId:s},dataType:"json",success:function(t){if(t.code="200"){e.sUserList=t.data;for(var a=0;a<e.sUserList.length;a++)e.sUserList[a].OtherChannels=t.data[a].totalCustomer-t.data[a].pushCount,e.sUserList[a].MeantimeLength=Number(t.data[a].totalCallTime/t.data[a].totalCallCount).toFixed(2),e.sUserList[a].ConnectionRate=Number(t.data[a].validCount/t.data[a].totalCallCount*100).toFixed(2)}else console.log(t.code)},error:function(t){console.log(t)}})):""!=a&&""!=o&&($.ajax({type:"GET",url:t+"/historyStatis/company",headers:{token:e.token},data:{begin:a,end:o},dataType:"json",success:function(t){"200"==t.code?(e.sTotalList=t.data,e.sTotalList.OtherChannels=t.data.totalCustomer-t.data.pushCount,e.sTotalList.MeantimeLength=Number(t.data.totalCallTime/t.data.totalCallCount).toFixed(2),e.sTotalList.ConnectionRate=Number(t.data.validCount/t.data.totalCallCount*100).toFixed(2)):console.log(t.code)},error:function(t){console.log(t)}}),$.ajax({type:"GET",url:t+"/historyStatis/dept",headers:{token:e.token},data:{begin:a,end:o},dataType:"json",success:function(t){if("200"==t.code){e.sDepartmentList=t.data;for(var a=0;a<e.sDepartmentList.length;a++)e.sDepartmentList[a].OtherChannels=t.data[a].totalCustomer-t.data[a].pushCount,e.sDepartmentList[a].MeantimeLength=Number(t.data[a].totalCallTime/t.data[a].totalCallCount).toFixed(2),e.sDepartmentList[a].ConnectionRate=Number(t.data[a].validCount/t.data[a].totalCallCount*100).toFixed(2)}else console.log(t.code)},error:function(t){console.log(t)}}),$.ajax({type:"GET",url:t+"/historyStatis/user",headers:{token:e.token},data:{begin:a,end:o},dataType:"json",success:function(t){if("200"==t.code){e.sUserList=t.data;for(var a=0;a<e.sUserList.length;a++)e.sUserList[a].OtherChannels=t.data[a].totalCustomer-t.data[a].pushCount,e.sUserList[a].MeantimeLength=Number(t.data[a].totalCallTime/t.data[a].totalCallCount).toFixed(2),e.sUserList[a].ConnectionRate=Number(t.data[a].validCount/t.data[a].totalCallCount*100).toFixed(2)}else console.log(t.code)},error:function(t){console.log(t)}}))}},created:function(){var e=new Cookies,a=e.getChild("md_user","username");if(null!=a&&""!=a){this.username=a,this.token=e.getChild("md_user","token");var o=e.getChild("md_user","role");"manager"!=o&&"leader"!=o||(this.isHiddenStatisticsMenu=!1),"manager"==o&&(this.isHiddenDataMenu=!0)}else window.location.href="login.html";var s=new Date;this.startDate=s.getFullYear()+"-"+(s.getMonth()+1)+"-1",this.endDate=s.getFullYear()+"-"+(s.getMonth()+1)+"-"+s.getDate(),this.departmentList=getDepartmentList(t,this.token),this.userList=getUserList(t,this.token),this.Search()}})});