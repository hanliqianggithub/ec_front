function getDepartmentList(t,e){var a=[];return $.ajax({type:"GET",async:!1,url:t+"/department",headers:{token:e},dataType:"json",success:function(t){"200"==t.code?a=t.data.list:console.log(t.code)},error:function(t){console.log(t)}}),a}function getUserList(t,e){var a=[];return $.ajax({type:"GET",async:!1,url:t+"/user",headers:{token:e},dataType:"json",success:function(t){"200"==t.code?a=t.data:console.log(t.code)},error:function(t){console.log(t)}}),a}function getToken(){var t=(new Cookies).getChild("md_user","token");if(null!=t&&""!=t)return t;window.location.href="login.html"}function formateTimes(t){var e="";if(t>-1){var a=Math.floor(t/3600),o=Math.floor(t/60)%60,s=t%60;a>0&&(e+=a+":"),o>0&&(e+=o+"'"),e+=s+"''"}return e}function orderTableData(t,e,a){if(null!=t){for(var o=t,s=0;s<o.length-1;s++)for(var n=s+1;n<o.length;n++)if(0==a){if(parseFloat(o[s][e])<parseFloat(o[n][e])){l=o[s];o[s]=o[n],o[n]=l}}else if(parseFloat(o[s][e])>parseFloat(o[n][e])){var l=o[s];o[s]=o[n],o[n]=l}return o}return null}$(function(){var t="http://47.92.107.76/server";new Vue({el:"#statistics",data:{username:"",token:"",isHiddenDataMenu:!1,isHiddenStatisticsMenu:!0,isHiddenViewMenu:!0,startDate:"",endDate:"",departmentList:[],userList:[],sTotalList:null,sDepartmentList:null,sUserList:null,sortparam:"",sorttype:1},methods:{Search:function(){var e=this;e.token=getToken();var a=""==$("#start-date").val()?e.startDate:$("#start-date").val(),o=""==$("#end-date").val()?e.endDate:$("#end-date").val(),s=$("#department-list").val();e.startDate=a,e.endDate=o,$(".main-msg div .front-blue:first-child").html(a),$(".main-msg div .front-blue:last-child").html(o),""!=a&&""!=o&&"0"!=s?(e.sDepartmentList=null,$.ajax({type:"GET",url:t+"/historyStatis/dept/"+s,headers:{token:e.token},data:{begin:a,end:o},dataType:"json",success:function(t){if("200"==t.code){e.sTotalList=t.data,e.sTotalList.totalCallTimeF=formateTimes(t.data.totalCallTime);var a=Number(t.data.totalCallTime/t.data.totalCallCount).toFixed(2);e.sTotalList.MeantimeLength="NaN"==a?0:a;var o=Number(t.data.validCount/t.data.totalCallCount*100).toFixed(2);e.sTotalList.ConnectionRate="NaN"==o?0:o}else console.log(t.code)},error:function(t){console.log(t)}}),$.ajax({type:"GET",url:t+"/historyStatis/user",headers:{token:e.token},data:{begin:a,end:o,deptId:s},dataType:"json",success:function(t){if(t.code="200"){e.sUserList=t.data;for(var a=0;a<e.sUserList.length;a++){e.sUserList[a].totalCallTimeF=formateTimes(t.data[a].totalCallTime);var o=Number(t.data[a].totalCallTime/t.data[a].totalCallCount).toFixed(2);e.sUserList[a].MeantimeLength="NaN"==o?0:o;var s=Number(t.data[a].validCount/t.data[a].totalCallCount*100).toFixed(2);e.sUserList[a].ConnectionRate="NaN"==s?0:s}}else console.log(t.code)},error:function(t){console.log(t)}})):""!=a&&""!=o&&($.ajax({type:"GET",url:t+"/historyStatis/company",headers:{token:e.token},data:{begin:a,end:o},dataType:"json",success:function(t){if("200"==t.code){e.sTotalList=t.data,e.sTotalList.totalCallTimeF=formateTimes(t.data.totalCallTime);var a=Number(t.data.totalCallTime/t.data.totalCallCount).toFixed(2);e.sTotalList.MeantimeLength="NaN"==a?0:a;var o=Number(t.data.validCount/t.data.totalCallCount*100).toFixed(2);e.sTotalList.ConnectionRate="NaN"==o?0:o}else console.log(t.code)},error:function(t){console.log(t)}}),$.ajax({type:"GET",url:t+"/historyStatis/dept",headers:{token:e.token},data:{begin:a,end:o},dataType:"json",success:function(t){if("200"==t.code){e.sDepartmentList=t.data;for(var a=0;a<e.sDepartmentList.length;a++){e.sDepartmentList[a].totalCallTimeF=formateTimes(t.data[a].totalCallTime);var o=Number(t.data[a].totalCallTime/t.data[a].totalCallCount).toFixed(2);e.sDepartmentList[a].MeantimeLength="NaN"==o?0:o;var s=Number(t.data[a].validCount/t.data[a].totalCallCount*100).toFixed(2);e.sDepartmentList[a].ConnectionRate="NaN"==s?0:s}}else console.log(t.code)},error:function(t){console.log(t)}}),$.ajax({type:"GET",url:t+"/historyStatis/user",headers:{token:e.token},data:{begin:a,end:o},dataType:"json",success:function(t){if("200"==t.code){e.sUserList=t.data;for(var a=0;a<e.sUserList.length;a++){e.sUserList[a].totalCallTimeF=formateTimes(t.data[a].totalCallTime);var o=Number(t.data[a].totalCallTime/t.data[a].totalCallCount).toFixed(2);e.sUserList[a].MeantimeLength="NaN"==o?0:o;var s=Number(t.data[a].validCount/t.data[a].totalCallCount*100).toFixed(2);e.sUserList[a].ConnectionRate="NaN"==s?0:s}}else console.log(t.code)},error:function(t){console.log(t)}}))},OrderBy:function(t,e,a){var o=this;if(o.token=getToken(),"dept"==t)for(var s=orderTableData(o.sDepartmentList,e,a),n=0;n<s.length;n++)Vue.set(o.sDepartmentList,n,s[n]);else if("user"==t)for(var s=orderTableData(o.sUserList,e,a),n=0;n<s.length;n++)Vue.set(o.sUserList,n,s[n])}},created:function(){var e=this,a=new Cookies,o=a.getChild("md_user","username");if(null!=o&&""!=o){this.username=o,this.token=a.getChild("md_user","token");var s=a.getChild("md_user","role");"manager"!=s&&"leader"!=s||(this.isHiddenStatisticsMenu=!1),"manager"==s&&(this.isHiddenDataMenu=!0);var n=a.getChild("md_user","userid");4!=n&&"4"!=n||(this.isHiddenViewMenu=!1)}else window.location.href="login.html";var l=new Date;e.startDate=l.getFullYear()+"-"+(l.getMonth()+1)+"-1",e.endDate=l.getFullYear()+"-"+(l.getMonth()+1)+"-"+l.getDate(),e.departmentList=getDepartmentList(t,e.token),e.Search()}});$(".sorts span").click(function(){$(this).parents("tr").find(".sorts span").removeClass("current"),$(this).addClass("current")})});