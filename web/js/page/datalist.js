function getVocationList(){var t=[];return $.get("temp/json/vacation-map.json",{},function(a){for(var e=0;e<a.length;e++)1==a[e].vocationGrade&&t.push({vocationCode:a[e].vocationCode,vocationName:a[e].vocationName})}),t}function getProvinceList(){var t=[];return $.get("temp/json/area-map.json",{},function(a){for(var e=0;e<a.length;e++)"1"==a[e].grade&&t.push({id:a[e].id,name:a[e].name})}),t}function getCityList(t){var a=[];return $.get("temp/json/area-map.json",{},function(e){if("110000"==t||"120000"==t||"310000"==t||"500000"==t)for(n=0;n<e.length;n++)e[n].id.substring(0,2)==t.substring(0,2)&&"3"==e[n].grade&&a.push({id:e[n].id,name:e[n].name});else for(var n=0;n<e.length;n++)e[n].id.substring(0,2)==t.substring(0,2)&&"2"==e[n].grade&&a.push({id:e[n].id,name:e[n].name})}),a}function getPushData(t,a){var e={pushedCount:"0",pushTotal:"0",percent:"0"};return $.ajax({type:"GET",async:!1,url:t+"/user/pushCount",headers:{token:a},dataType:"json",success:function(t){"200"==t.code?(e.pushedCount=t.data.pushedCount,e.pushTotal=t.data.threshold,e.percent=Math.round(100*e.pushedCount/e.pushTotal)+"%"):console.log(t.code)},error:function(t){console.log(t)}}),e}function getTableData(t,a,e){var n={totalPage:0,totalCount:0,list:null};return $.ajax({type:"POST",async:!1,url:t+"/contact",headers:{"Content-Type":"application/json",token:a},data:JSON.stringify(e),dataType:"json",success:function(t){"200"==t.code?(n.totalPage=t.data.totalPage,n.totalCount=t.data.totalCount,t.data.list.length>0?n.list=t.data.list:n.list=null):console.log(t.code)},error:function(t){console.log(t)}}),n}function getDetails(t,a,e){var n={};return $.ajax({type:"GET",async:!1,url:t+"/contact/"+e,headers:{"Content-Type":"application/x-www-form-urlencoded",token:a},dataType:"json",success:function(t){"200"==t.code?n=t.data:console.log(t.code)},error:function(t){console.log(t)}}),n}function setSearchInfo(t,a,e){var n=t;if(n.page=0,"extra"==a&&(n.extra=e,n.companyName=null,n.address=null,n.jobName=null,n.comintro=null),"companyName"==a&&(n.extra=null,n.companyName=e,n.address=null,n.jobName=null,n.comintro=null),"address"==a&&(n.extra=null,n.companyName=null,n.address=e,n.jobName=null,n.comintro=null),"jobName"==a&&(n.extra=null,n.companyName=null,n.address=null,n.jobName=e,n.comintro=null),"comintro"==a&&(n.extra=null,n.companyName=null,n.address=null,n.jobName=null,n.comintro=e),"province"==a&&(n.provinces=[],parseInt(e)>0))for(var s=$("#province > span a.current"),o=0;o<s.length;o++)(i=parseInt(s.eq(o).attr("data-id")))>0&&n.provinces.push(i.toString());if("city"==a&&(n.cities=[],parseInt(e)>0))for(var s=$("#city li span a.current"),o=0;o<s.length;o++)(i=parseInt(s.eq(o).attr("data-id")))>0&&n.cities.push(i.toString());if("vocation"==a&&(n.vocations=[],parseInt(e)>0))for(var s=$("#vocation > span a.current"),o=0;o<s.length;o++)(i=parseInt(s.eq(o).attr("data-id")))>0&&n.vocations.push(i);if("size"==a&&(n.memberSizeTags=[],parseInt(e)>0))for(var s=$("#size > span a.current"),o=0;o<s.length;o++)(i=parseInt(s.eq(o).attr("data-id")))>0&&n.memberSizeTags.push(i);if("website"==a&&(n.websiteIds=[],parseInt(e)>0))for(var s=$("#website > span a.current"),o=0;o<s.length;o++){var i=parseInt(s.eq(o).attr("data-id"));i>0&&n.websiteIds.push(i)}return"hasMobile"==a&&(n.hasMobile=e),"needSale"==a&&(n.needSale=e),n}function getPagerData(t,a){var e={};e.index=t+1,1==e.index?e.hasPrev=!1:e.hasPrev=!0,e.index==a?e.hasNext=!1:e.hasNext=!0,e.pagerlist=[];var n=5*Math.ceil(e.index/5),s=a<n?a:n,o=s-4;for(o<=0&&(o=1),o;o<=s;o++)e.pagerlist.push(o);return e}function getProvinceMap(){return{110000:"北京市",120000:"天津市",130000:"河北省",140000:"山西省",150000:"内蒙古自治区",210000:"辽宁省",220000:"吉林省",230000:"黑龙江省",310000:"上海市",320000:"江苏省",330000:"浙江省",340000:"安徽省",350000:"福建省",360000:"江西省",370000:"山东省",410000:"河南省",420000:"湖北省",430000:"湖南省",440000:"广东省",450000:"广西壮族自治区",460000:"海南省",500000:"重庆市",510000:"四川省",520000:"贵州省",530000:"云南省",540000:"西藏自治区",610000:"陕西省",620000:"甘肃省",630000:"青海省",640000:"宁夏回族自治区",650000:"新疆维吾尔自治区",710000:"台湾省",810000:"香港特别行政区",820000:"澳门特别行政区"}}function getVocationMap(){return{1:"IT/通信/电子/互联网",2:"金融业",3:"房地产/建筑业",4:"法律",5:"商业服务",6:"医疗/健康",7:"贸易/批发/零售/租赁业",8:"生产/加工/制造",9:"交通/运输/物流/仓储",10:"服务业",11:"体育/休闲/旅游/娱乐",12:"能源/矿产/环保",13:"政府/非盈利机构",14:"媒体",15:"教育",16:"农/林/牧/渔",17:"跨领域经营",18:"其他"}}function getSizeMap(){return{1:"0-50人",2:"51-150人",3:"151-500人",4:"501-2000人",5:"2000人以上"}}$(function(){url="http://47.92.107.76/server",new Vue({el:"#datalist",data:{username:"",token:"",isHiddenDataMenu:!1,isHiddenStatisticsMenu:!0,provinceMap:getProvinceList(),cityMap:[],vocationMap:getVocationList(),isHavePhone:!1,isRecruitment:!1,pushData:{},Detail:{},tableData:{},searchInfo:{page:0,size:10},pagers:{index:1,hasPrev:!1,hasNext:!0,pagerlist:[1,2,3,4,5]},dataMapProvice:getProvinceMap(),dataMapVocation:getVocationMap(),dataMapSize:getSizeMap()},methods:{searchByKeywords:function(){var t=$("#keywords .input-drop ul li:first-child").attr("data-code"),a=$("#keywords .txt-com").val(),e=setSearchInfo(this.searchInfo,t,a);this.tableData=getTableData(url,this.token,e),this.pagers=getPagerData(this.searchInfo.page,this.tableData.totalPage)},searchCheck:function(t){var a=this;if(1==t){a.isHavePhone=!a.isHavePhone;e=setSearchInfo(this.searchInfo,"hasMobile",a.isHavePhone);this.tableData=getTableData(url,this.token,e),this.pagers=getPagerData(this.searchInfo.page,this.tableData.totalPage)}else if(2==t){a.isRecruitment=!a.isRecruitment;var e=setSearchInfo(this.searchInfo,"needSale",a.isRecruitment);this.tableData=getTableData(url,this.token,e),this.pagers=getPagerData(this.searchInfo.page,this.tableData.totalPage)}},searchSelect:function(t,a,e){if("0"!=t){var n=$("#"+a+" span a[data-id="+t+"]");if(n.hasClass("current")){if(n.removeClass("current"),$("#"+a+" > span a.current").length<=0)$("#"+a+" > span a[name=all]").addClass("current"),"province"==a&&(this.cityMap=[],$("#province .opts-a").hide(),$("#province .list-children").hide());else if("province"==a)for(var s=0;s<this.cityMap.length;s++)this.cityMap[s].code==t&&this.cityMap.splice(s,1)}else $("#"+a+" > span a[name=all]").removeClass("current"),n.addClass("current"),"province"==a&&(this.cityMap.push({code:t,name:$("#"+a+" span a[data-id="+t+"]").html(),list:getCityList(t)}),$("#province .opts-a").show(),$("#province .list-children").show())}else $("#"+a+" span a").removeClass("current"),$("#"+a+" a[name=all]").addClass("current"),"province"==a&&(this.cityMap=[],$("#province .opts-a").hide(),$("#province .list-children").hide());null!=e&&(a=e);var o=setSearchInfo(this.searchInfo,a,t);this.tableData=getTableData(url,this.token,o),this.pagers=getPagerData(this.searchInfo.page,this.tableData.totalPage)},showDetails:function(t){this.Detail=getDetails(url,this.token,t),$("#com-layer1").modal("show")},prev:function(){this.searchInfo.page--,this.pagers=getPagerData(this.searchInfo.page,this.tableData.totalPage),this.tableData=getTableData(url,this.token,this.searchInfo)},next:function(){this.searchInfo.page++,this.pagers=getPagerData(this.searchInfo.page,this.tableData.totalPage),this.tableData=getTableData(url,this.token,this.searchInfo)},goto:function(t){null==t&&((t=parseInt($("#go-page").val()))>this.tableData.totalPage&&(t=this.tableData.totalPage),t<1&&(t=1),$("#go-page").val(t)),this.searchInfo.page=t-1,this.pagers=getPagerData(this.searchInfo.page,this.tableData.totalPage),this.tableData=getTableData(url,this.token,this.searchInfo)},push:function(t){var a=this;$.ajax({type:"POST",url:url+"/push",headers:{"Content-Type":"application/json",token:this.token},data:JSON.stringify({ids:[t]}),dataType:"json",success:function(t){"200"==t.code?(a.pushData=getPushData(url,a.token),a.tableData=getTableData(url,a.token,a.searchInfo),a.pagers=getPagerData(a.searchInfo.page,a.tableData.totalPage),$("#com-alert1 .modal-body h2").html("线索数据推送成功"),$("#com-alert1").modal("show")):(console.log(t.code),$("#com-alert1 .modal-body h2").html("线索数据推送失败，请稍后重试"),$("#com-alert1").modal("show"))},error:function(t){console.log(t)}})},pushAll:function(){for(var t=this,a=$(".data-table .check-item[name='list-item']"),e=[],n=0;n<a.length;n++)a.eq(n).find(".icon span").hasClass("checked")&&e.push(parseInt(a.eq(n).attr("data-id")));e.length>0?e.length<=t.pushData.pushTotal-t.pushData.pushedCount?$.ajax({type:"POST",url:url+"/push",headers:{"Content-Type":"application/json",token:t.token},data:JSON.stringify({ids:e}),dataType:"json",success:function(a){"200"==a.code?(t.pushData=getPushData(url,t.token),t.tableData=getTableData(url,t.token,t.searchInfo),t.pagers=getPagerData(t.searchInfo.page,t.tableData.totalPage),$(".data-table .check-item .icon span").removeClass("checked"),$("#com-alert1 .modal-body h2").html("成功推送"+a.data.successCount+"条线索数据"),$("#com-alert1").modal("show")):(console.log(a.code),$("#com-alert1 .modal-body h2").html("线索数据推送失败，请稍后重试"),$("#com-alert1").modal("show"))},error:function(t){console.log(t)}}):($("#com-alert1 .modal-body h2").html("今天您最多还能推送"+(t.pushData.pushTotal-t.pushData.pushedCount)+"条线索数据"),$("#com-alert1").modal("show")):($("#com-alert1 .modal-body h2").html("请选择要推送的线索数据"),$("#com-alert1").modal("show"))}},created:function(){var t=new Cookies,a=t.getChild("md_user","username");if(null!=a&&""!=a){this.username=a,this.token=t.getChild("md_user","token");var e=t.getChild("md_user","role");"manager"!=e&&"leader"!=e||(this.isHiddenStatisticsMenu=!1),"manager"==e&&(this.isHiddenDataMenu=!0)}else window.location.href="login.html";this.pushData=getPushData(url,this.token),this.tableData=getTableData(url,this.token,this.searchInfo),this.pagers=getPagerData(this.searchInfo.page,this.tableData.totalPage)}}),$("#keywords .input-drop ul li").click(function(){var t=$(this).find("p:first-child"),a=$("#keywords .input-drop ul li:first-child").find("p:first-child"),e=$("#keywords .input-drop span:first-child"),n=t.html(),s=a.html();if(n!=s){e.html(n),t.html(s),a.html(n);var o=$(this).attr("data-code"),i=$("#keywords .input-drop ul li:first-child").attr("data-code");$(this).attr("data-code",i),$("#keywords .input-drop ul li:first-child").attr("data-code",o)}$("#keywords .input-drop ul").hide()}),$("#keywords .input-drop").mouseover(function(){$(this).find("ul").show()}),$("#keywords .input-drop").mouseout(function(){$(this).find("ul").hide()}),$(".containers .content .search-bottom .more span").click(function(){if($(this).hasClass("up"))$(this).attr("class","down"),$(".containers .content .search-bottom .search-bottom-main").animate({height:"113px"});else{$(this).attr("class","up");var t=$(".containers .content .search-bottom .search-bottom-main ul").height()+20;$(".containers .content .search-bottom .search-bottom-main").animate({height:t})}}),$("#province .list-children .opts .btn-com").click(function(){$("#province .list-children").hide()}),$("#province .opts-a").click(function(){$("#province .list-children").show()}),$(".data-table .check-item[name='list-all']").click(function(){$(this).find(".icon span").hasClass("checked")?($(".data-table .check-item[name='list-all'] .icon span").removeClass("checked"),$(".data-table table tr td .check-item .icon span").removeClass("checked")):($(".data-table .check-item[name='list-all'] .icon span").addClass("checked"),$(".data-table table tr td .check-item .icon span").addClass("checked"))}),$(".data-table").delegate(".check-item[name='list-item']","click",function(){$(this).find(".icon span").hasClass("checked")?($(this).find(".icon span").removeClass("checked"),$(".data-table .check-item[name='list-all'] .icon span").removeClass("checked")):($(this).find(".icon span").addClass("checked"),$(".data-table .check-item[name='list-item'] .icon .checked").length==$(".data-table .check-item[name='list-item']").length&&$(".data-table .check-item[name='list-all'] .icon span").addClass("checked"))})});